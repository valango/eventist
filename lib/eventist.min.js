/*!
 Eventist: event emitter for modular designs
 */
!function(t){"use strict";function e(){return this instanceof e?(this._events={},this._depth=0,this._hook=null,void(this._reporter=null)):new e}function n(t,e){throw new TypeError("Eventist#"+e+": "+t+"!")}function o(t,e,o,r){t!==typeof e&&n([o,"must","be",t].join(" "),r)}function r(t,e,o){typeof t===u&&null!==t||n(e+" must be an object instance",o)}var i="function",s="string",u="object",h=void 0,f=Array.prototype.slice,c=e.prototype;c.on=function(t,e,n){return this.on_(t,e,n)},c.once=function(t,e,n){return this.on_(t,e,n,!0)},c.on_=function(t,e,n,u){var f,c,l=this._events,a=u?"once":"on";return o(s,t,"event",a),o(i,e,"handler",a),n!==h&&r(n,"instance",a),c=[e,n],u&&c.push(u),(f=l[t])!==h?f.push(c):l[t]=[c],this},c.off=function(t,e,n){var i,u,f,c=this,l=c._events;if(o(s,t,"event","off"),n!==h&&r(n,"instance","off"),(i=l[t])!==h){if(e===!0)return delete l[t],c;for(u=i.length;--u>=0;)f=i[u],f[0]===e&&f[1]===n&&(i.splice(u,1),i.length===(u=0)&&delete l[t])}return c},c.unplug=function(t){var e,n,o,i=this,s=i._events,u=[];r(t,"instance","unplug");for(e in s)for(o=(n=s[e]).length;--o>=0;)n[o][1]===t&&u.push(e,n[o][0]);for(o=u.length;--o>=0;o-=1)i.off(u[o-1],u[o],t);return i},c.emit=function(){var t,e,n,o,r,i,s=h,u=this._reporter,c=0,l=this._hook,a=this;if(e=f.call(arguments),l&&l.call(a,e),o=e.shift(1),(t=this._events[o])!==h){t=t.slice(),n=a.execute.bind(this),r=t.length,a._depth+=1;try{do c+=1,i=t[--r],i[2]&&a.off(o,i[0],i[1]),s=n(i,e,o);while(s===h&&r>0)}catch(p){throw a._depth-=1,p}a._depth-=1}return u&&u(o,c,e),s},c.send=function(t){var e,n,r=this,u=f.call(arguments);return i===typeof t?(e=t)&&u.shift(1):e=null,o(s,u[0],"event","send"),n=function(t,e){return function(){var n=void 0,o=null;try{n=r.emit.apply(r,t)}catch(i){if(o=i,!e)throw i.hasOwnProperty("message")||(o=new Error(i+"")),o.message='Sending "'+t[0]+'": '+o.message,o}finally{e&&e(o,n,t)}}}(u,e),setTimeout(n,0),r},c.depth=function(){return this._depth},c.info=function(){var t,e={},n=this._events;for(t in n)e[t]=n[t].length;return e},c.hook=function(t){var e=this._hook;return t?(o(i,t,"callback","hook"),this._hook=t):this._hook=null,e},c.reporter=function(t){var e=this._reporter;return t?(o(i,t,"callback","reporter"),this._reporter=t):this._reporter=null,e},c.execute=function(t,e){return t[0].apply(t[1],e)},i===typeof define&&define.amd&&u===typeof define.amd?define(function(){return e}):u===typeof module&&module.exports?module.exports=e:(t=t||this,t.Eventist=e)}.call(this);